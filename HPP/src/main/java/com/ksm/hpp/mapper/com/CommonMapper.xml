<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.com.CommonMapper">
	
	<!-- 정책 조회 -->
	<select id="selectPoli" parameterType="map" resultType="camelCaseMap">
		SELECT POLI_SEQ				/*정책일련번호*/
			,  POLI_CODE			/*정책분류코드(01:사용자)*/
			,  POLI_NM				/*정책명*/
			,  POLI_VAL				/*정책값*/
			,  RMRK					/*비고*/
			,  FST_REG_ID			/*최초등록자아이디*/
			,  FST_REG_DTTI			/*최초등록일시*/
			,  LT_UPD_ID			/*최종수정자아이디*/
			,  LT_UPD_DTTI			/*최종수정일시*/
		  FROM TB_POLI				/*테이블_정책*/
		<trim prefix="WHERE" prefixOverrides="AND">  
			<if test='poliSeq != null and poliSeq != ""'>
				AND POLI_SEQ = #{poliSeq}
			</if>
			<if test='poliCode != null and poliCode != ""'>
				AND POLI_CODE = #{poliCode}
			</if>			
		</trim>		  
	</select>
	
	<!-- 메뉴 정보 조회 -->
	<select id="selectMnuInfo" parameterType="map" resultType="camelCaseMap">
		SELECT T2.MNU_NM AS MNU_UPPER_NM				/*상위메뉴명*/
			,  T1.MNU_NM						/*메뉴명*/
			,  T1.INFO						/*메뉴정보*/
			,  T1.URL						/*메뉴경로*/
			,  T1.TOP_URL					/*최상위메뉴경로*/
		  FROM TB_MNU T1						/*테이블_메뉴*/
		  JOIN TB_MNU T2						/*테이블_메뉴*/
		    ON T1.UPPER_URL = T2.URL
		 WHERE T1.URL LIKE CONCAT(#{url},'%')    
	</select>	
	
	<!-- 요청 로그 기록 -->
	<insert id="insertReqLog" parameterType="map">
		INSERT 
		  INTO TB_LOG_REQ			/*테이블_요청로그*/
		     (
		       REQ_SEQ				/*요청일련번호*/
		     , USER_ID				/*사용자아이디*/
		     , IP					/*사용자아이피*/
		     , URI					/*요청경로*/
		     , PARAM				/*요청파라미터*/
		     , REQ_TYPE_CODE 		/*요청타입코드*/
		     )
		VALUES
			 (
			   (SELECT nextval('REQ_SEQ') FROM DUAL)	/*요청일련번호*/
			 , #{loginInfo.userId}						/*사용자아이디*/
			 , #{loginInfo.ip}						/*사용자아이디*/
			 , #{uri}								/*요청경로*/
			 , #{param}								/*요청파라미터*/
		     , #{reqTypeCode} 							/*요청타입코드*/
			 )  	
	</insert>
</mapper>